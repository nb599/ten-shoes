# Agent UI 设计模式：前端如何承载自治代理

> 当应用从“对话”走向“自治代理（Agent）”，UI 的复杂度陡增：多工具调用、长任务、权限确认、可回放与纠错。本篇总结 8 个常用的 UI 模式与工程实践。

## 1. 任务树（Task Tree）

- 把复杂任务拆分为子任务，树形展示依赖关系与执行状态（等待、运行、成功、失败）。
- 支持**节点级**重试与跳过；失败节点就地展示错误与建议。

## 2. 工具调用时间线（Tool Timeline）

- 每次工具调用以卡片展示：输入参数、关键日志、输出摘要。
- 对敏感工具（如外部 API 或文件系统）加入权限确认（Just-in-time Consent）。

## 3. 流式进度与里程碑

- 长任务以“里程碑”而非百分比呈现，匹配 Agent 的非线性推进。
- 结合**乐观更新**与“回滚提示”，让用户随时可以中断或撤销。

## 4. 可回放与审计

- 把“自然语言意图 + 计划 + 工具参数 + 结果”序列化存档。
- 为每次运行生成 permalink，方便分享与复盘。

## 5. 纠错与人类介入（Human-in-the-loop）

- 失败时提供“最小可编辑单元”让用户纠偏（如仅修改 API 参数）。
- 支持“从某一步重新开始”，减少无谓重复。

## 6. 资源引用与证据链接

- 为每次工具调用的输入/输出保留引用链接，方便定位源头。
- 前端对资源进行**类型化**展示（代码、图表、图片、表格）。

## 7. 失败优先的可视化

- 把失败作为一等视图：可筛选、聚合错误原因、显示最近波动。
- 异常块可**单独重试**，不要强迫用户全量重跑。

## 8. 组织协作与权限

- 任务可共享给团队成员；可见性与编辑权限区分。
- 对外共享链接默认**只读**，敏感字段打码。

---

## 实施建议

- 从“可视化工具调用”开始，而非一次性引入全部模式。
- 前端与后端共享一个“调用事件协议”，保证事件的稳定性与可扩展性。
- 做好“取消、超时、重试”三件套；对每个工具设定**幂等策略**。
